<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Los Angeles Rams — News</title>
  <link rel="icon" href="static/favicon.ico" />
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <header class="site-header">
    <img id="logo" src="static/logo.png" alt="Rams logo" />
    <h1 id="title">Los Angeles Rams — News</h1>
  </header>

  <nav id="quick-links" class="pills"></nav>

  <section class="controls">
    <div class="left">
      <label for="sourceFilter">Source:</label>
      <select id="sourceFilter">
        <option value="">All sources</option>
      </select>
    </div>
    <div class="right">
      <span id="updated">Updated: —</span>
      <span id="newBadge" hidden>New items available — refresh</span>
    </div>
  </section>

  <main id="grid" class="grid"></main>

  <script>
    const state = { data: null, lastCount: 0 };

    async function loadData() {
      const res = await fetch("items.json", { cache: "no-store" });
      const data = await res.json();
      state.data = data;
      state.lastCount = data.items.length;
      render();
    }

    function render() {
      const data = state.data;
      if (!data) return;

      // Quick links
      const ql = document.getElementById("quick-links");
      ql.innerHTML = "";
      (data.static_links || []).forEach(l => {
        const a = document.createElement("a");
        a.href = l.url; a.target = "_blank"; a.rel = "noopener";
        a.textContent = l.label; a.className = "pill";
        ql.appendChild(a);
      });

      // Sources dropdown
      const dd = document.getElementById("sourceFilter");
      const chosen = dd.value;
      dd.innerHTML = '<option value="">All sources</option>';
      (data.sources || []).forEach(s => {
        const opt = document.createElement("option");
        opt.value = s; opt.textContent = s; dd.appendChild(opt);
      });
      if (chosen) dd.value = chosen;

      // Updated timestamp
      const ts = new Date(data.updated_at || Date.now());
      document.getElementById("updated").textContent = "Updated: " + ts.toLocaleString();

      // Article cards
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      let items = data.items || [];
      if (dd.value) items = items.filter(i => i.source === dd.value);
      for (const it of items) {
        const card = document.createElement("article"); card.className = "card";
        const a = document.createElement("a"); a.className = "title"; a.href = it.url; a.target = "_blank"; a.rel="noopener";
        a.textContent = it.title;
        const meta = document.createElement("div"); meta.className = "meta";
        const d = new Date(it.published || Date.now());
        meta.textContent = (it.source || "Source") + " • " + d.toLocaleString();
        card.appendChild(a); card.appendChild(meta); grid.appendChild(card);
      }
    }

    // Poll every 5 min for updates
    async function poll() {
      try {
        const res = await fetch("items.json", { cache: "no-store" });
        const data = await res.json();
        const newCount = (data.items || []).length;
        if (newCount > state.lastCount) {
          const badge = document.getElementById("newBadge");
          badge.hidden = false;
          badge.onclick = () => {
            state.data = data;
            state.lastCount = newCount;
            badge.hidden = true;
            render();
          };
        }
      } catch(e){}
    }

    document.getElementById("sourceFilter").addEventListener("change", render);

    loadData();
    setInterval(poll, 5 * 60 * 1000);
  </script>
</body>
</html>
